<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bingo - CNY Edition</title>

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #bfbfbf;
  margin: 0;
}

h1 {
  margin: 12px 0;
}

button {
  font-size: 18px;
  padding: 10px 18px;
  margin: 6px;
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

#timer {
  font-size: 32px;
  font-weight: bold;
  margin: 10px 0;
  color: #c62828;
}

/* MAIN LAYOUT */
#gameArea {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: 20px;
  padding: 12px;
}

/* SYMBOL AREAS */
#symbolsLeft {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(5, 1fr);
  gap: 12px;
  width: 28vw;
  max-width: 320px;
}

#symbolsRight {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  grid-template-rows: repeat(5, 1fr);
  gap: 12px;
  width: 20vw;
  max-width: 240px;
}

/* BOARD */
#board {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 10px;
  width: 42vw;
  max-width: 480px;
}

/* CELL (square fallback) */
.cell {
  background: white;
  border: 2px solid #333;
  position: relative;
  width: 100%;
  padding-top: 100%;
  overflow: hidden;
}

@supports (aspect-ratio: 1 / 1) {
  .cell {
    padding-top: 0;
    aspect-ratio: 1 / 1;
  }
}

.cell-content {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cell.marked::after {
  content: "âœ–";
  position: absolute;
  font-size: 48px;
  color: rgba(200, 0, 0, 0.85);
  font-weight: bold;
  z-index: 2;
}

.cell.marked img {
  opacity: 0.4;
}

.symbol {
  max-width: 85%;
  max-height: 85%;
  width: auto;
  height: auto;
  object-fit: contain;
  cursor: grab;
  background: #4CAF50;
  border-radius: 14px;
  touch-action: none;
  display: block;
}

/* PHONES ONLY */
@media (max-width: 768px) {
  #gameArea {
    flex-direction: column;
    align-items: center;
  }

  #symbolsLeft,
  #symbolsRight {
    grid-template-columns: repeat(5, 1fr);
    width: 95vw;
    max-width: 700px;
  }

  #board {
    width: 95vw;
    max-width: 700px;
  }
}
</style>
</head>

<body>

<h1>ðŸ§§ Bingo â€“ CNY Edition ðŸ§§</h1>

<div id="timer">05:00</div>

<div>
  <button id="startBtn">Start</button>
  <button id="confirmBtn">Confirm</button>
  <button id="resetBtn">Reset</button>
</div>

<div id="gameArea">
  <div id="symbolsLeft"></div>
  <div id="board"></div>
  <div id="symbolsRight"></div>
</div>

<script>
const images = [
  "images/01.jpg","images/02.png","images/03.jpg","images/04.jpg","images/05.png",
  "images/06.jpg","images/07.png","images/08.jpg","images/09.jpg","images/10.jpg",
  "images/11.jpg","images/12.jpg","images/13.png","images/14.jpg","images/15.jpg",
  "images/16.jpg","images/17.png","images/18.jpg","images/19.jpg","images/20.jpg",
  "images/21.jpg","images/22.png","images/23.jpg","images/24.jpg","images/25.jpg"
];

let locked = false;
let dragged = null;
let timerInterval = null;
let timeRemaining = 300;

startBtn.onclick = startGame;
confirmBtn.onclick = confirmBoard;
resetBtn.onclick = resetGame;

function startGame() {
  if (timerInterval) return;
  locked = false;
  startBtn.disabled = true;
  createBoard();
  createSymbols(shuffle([...images]));
  startTimer();
  removeBingoOverlay();
}

function startTimer() {
  timeRemaining = 300;
  updateTimer();
  timerInterval = setInterval(() => {
    timeRemaining--;
    updateTimer();
    if (timeRemaining <= 0) {
      clearInterval(timerInterval);
      autoConfirm();
    }
  }, 1000);
}

function updateTimer() {
  const m = String(Math.floor(timeRemaining / 60)).padStart(2, '0');
  const s = String(timeRemaining % 60).padStart(2, '0');
  timer.textContent = `${m}:${s}`;
}

function autoConfirm() {
  if (!locked) {
    locked = true;
    disableButtons();
    alert("â° Time's up! Board automatically confirmed!");
  }
}

function createBoard() {
  board.innerHTML = "";
  for (let i = 0; i < 25; i++) {
    const cell = document.createElement("div");
    cell.className = "cell";

    const content = document.createElement("div");
    content.className = "cell-content";
    cell.appendChild(content);

    cell.ondragover = e => e.preventDefault();
    cell.ondrop = e => {
      e.preventDefault();
      if (!locked && dragged) {
        if (content.firstChild) returnSymbolToSide(content.firstChild);
        content.appendChild(dragged);
      }
    };

    cell.onclick = () => {
      if (locked && content.firstChild) {
        cell.classList.toggle("marked");
        checkBingo();
      }
    };

    board.appendChild(cell);
  }
}

function createSymbols(list) {
  symbolsLeft.innerHTML = "";
  symbolsRight.innerHTML = "";
  list.forEach((src, i) => {
    const img = document.createElement("img");
    img.src = src;
    img.className = "symbol";
    img.draggable = true;
    img.ondragstart = () => dragged = img;
    img.ondragend = () => dragged = null;
    (i < 15 ? symbolsLeft : symbolsRight).appendChild(img);
  });
}

function returnSymbolToSide(img) {
  (symbolsLeft.children.length <= symbolsRight.children.length ? symbolsLeft : symbolsRight).appendChild(img);
}

function confirmBoard() {
  if (!locked) {
    locked = true;
    clearInterval(timerInterval);
    disableButtons();
    alert("Board confirmed! ðŸŽ‰ Game start!");
  }
}

function resetGame() {
  clearInterval(timerInterval);
  timerInterval = null;
  timer.textContent = "05:00";
  board.innerHTML = "";
  symbolsLeft.innerHTML = "";
  symbolsRight.innerHTML = "";
  locked = false;
  startBtn.disabled = false;
  confirmBtn.disabled = false;
  resetBtn.disabled = false;
  removeBingoOverlay();
}

function disableButtons() {
  confirmBtn.disabled = true;
  resetBtn.disabled = true;
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function checkBingo() {
  const cells = [...document.querySelectorAll(".cell")];
  const lines = [
    [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],
    [15,16,17,18,19],[20,21,22,23,24],
    [0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],
    [3,8,13,18,23],[4,9,14,19,24],
    [0,6,12,18,24],[4,8,12,16,20]
  ];

  for (const line of lines) {
    if (line.every(i => cells[i].classList.contains("marked"))) {
      showBingo(line.map(i => cells[i]));
      break;
    }
  }
}

function showBingo(winningLine) {
  removeBingoOverlay();

  const overlay = document.createElement("div");
  overlay.id = "bingoOverlay";
  overlay.style = `
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.85);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    color:white;
    z-index:1000;
  `;

  const title = document.createElement("div");
  title.textContent = "BINGO!! ðŸŽ‰";
  title.style.fontSize = "80px";
  title.style.marginBottom = "40px";
  overlay.appendChild(title);

  const row = document.createElement("div");
  row.style.display = "flex";
  row.style.gap = "20px";
  row.style.flexWrap = "wrap";
  row.style.justifyContent = "center";

  winningLine.forEach(cell => {
    const img = cell.querySelector("img")?.cloneNode(true);
    if (img) {
      img.style.width = "120px";
      img.style.height = "120px";
      img.style.objectFit = "contain";
      img.style.background = "#4CAF50";
      img.style.borderRadius = "14px";
      img.style.padding = "10px";
      row.appendChild(img);
    }
  });

  overlay.appendChild(row);
  overlay.onclick = () => overlay.remove();
  document.body.appendChild(overlay);
}

function removeBingoOverlay() {
  document.getElementById("bingoOverlay")?.remove();
}
</script>

</body>
</html>
